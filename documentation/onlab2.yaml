---
swagger: '2.0'


info:
  version: v1
  title: TestManagement Studio Backend API
  description: |
    <<Some text >>

    
    Would respond with:
    ```js
    callbackFunction({
        ...
    });
    ```

################################################################################
#                  Host, Base Path, Schemes and Content Types                  #
################################################################################
host: localhost
basePath: /v1
schemes:
  - http
  - https
consumes:
  - application/x-www-form-urlencoded  
  - application/json
produces:
  - application/json
################################################################################
#                                  Security                                    #
################################################################################
securityDefinitions:
  Bearer:
    type: apiKey
    name: Authorization
    in: header
security:
  - Bearer: []

################################################################################
#                                   Parameters                                 #
################################################################################
parameters:
  userId:
    name: userId
    in: path
    description: The entity identifier number
    type: number
    format: int32
    required: true
    
  groupId:
    name: groupId
    in: path
    description: The group identifier number
    type: number
    format: int32
    required: true
    
  roleId:
    name: roleId
    in: path
    description: The role identifier number
    type: number
    format: int32
    required: true
    
  categoryId:
    name: categoryId
    in: path
    description: The category identifier number
    type: number
    format: int32
    required: true
    
################################################################################
#                                 Definitions                                  #
################################################################################
definitions:
  ErrorMessage:
    type: object
    properties:
      title:
        type: string
      text:
        type: string
  Entity:
    type: object
    properties:
      id:
        type: integer
        format: int32
      permissions:
          type: array
          items:
            $ref: '#/definitions/Permission'      
            
  SecuredEntity:
    type: object
    allOf:
    - $ref: '#/definitions/Entity'
    - type: object
    properties:
      id:
        type: integer
        format: int32
      permissions:
          type: array
          items:
            $ref: '#/definitions/Permission'
  RolePart:
    type: object
    allOf:
    - $ref: '#/definitions/Entity'
    - type: object
    properties:
      name:
        type: string
      accessType:
        type: integer
        format: int32
  Role:
    type: object
    allOf:
    - $ref: '#/definitions/Entity'
    - type: object
    properties:
      isRoot:
        description: "If this property set to true, user has access to any part of the services"
        type: boolean
      parts:
        type: array
        items:
          $ref: '#/definitions/RolePart'
        
  Actor:
    type: object
    description: "Anyone who can does actions. (Users & Groups)"
    allOf:
    - $ref: '#/definitions/SecuredEntity'
    - type: object
      properties:
        roles:
          type: array
          items:
            $ref: '#/definitions/Role'
        testSets:
          description: "Tests to to be completed, assigned to the actor"
          type: array
          items:
            $ref: '#/definitions/TestSet'

  Permission:
    type: object
    allOf:
    - $ref: '#/definitions/Entity'
    - type: object
    properties:
      read:
        type: boolean
      write:
        type: boolean
      subject:
        $ref: '#/definitions/Actor'
      object:
        $ref: '#/definitions/Entity'
      objectType:
        description: "Discriminator to the actors. Group | user"
        type: string
        
  User:
    type: object
    allOf:
    - $ref: '#/definitions/Actor'
    - type: object
      properties:
        email:
          type: string
        password:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        groups:
          description: "Groups which are created by the user"
          type: array
          items:
            $ref: '#/definitions/Group'
        memberOf:
          type: array
          items:
            $ref: '#/definitions/Group'
        tests:
          description: "Tests created by the user"
          type: array
          items:
            $ref: '#/definitions/Test'

        testExecutions:
          description: "Tests are completed by the user"
          type: array
          items:
            $ref: '#/definitions/TestExecution'
            
  Group:
    type: object
    allOf:
    - $ref: '#/definitions/Actor'
    - type: object
      properties:
        name:
          type: string
        isPrivate:
          description: "The group visible for only the creator."
          type: boolean
        creator:
          $ref: '#/definitions/User'
        members:
          description: "Users who are member of this group."
          type: array
          items:
            $ref: '#/definitions/User'
  
  Category:
    type: object
    allOf:
    - $ref: '#/definitions/SecuredEntity'
    - type: object
      properties:
        name:
          type: string
        parent:
          $ref: '#/definitions/Category'
        childrens:
          type: array
          items:
            $ref: '#/definitions/Category'
        questions:
          type: array
          items:
            $ref: '#/definitions/Question'
        tests:
          type: array
          items:
            $ref: '#/definitions/Test'
  Answer:
    type: object
    allOf:
    - $ref: '#/definitions/Entity'
    - type: object
      properties:
        text:
          type: string
        correct:
          type: boolean
          
  Question:
    type: object
    allOf:
    - $ref: '#/definitions/SecuredEntity'
    - type: object
      properties:
        text:
          type: string
        answersAll:
          type: array
          items:
            $ref: '#/definitions/Answer'
        categories:
          type: array
          items:
            $ref: '#/definitions/Category'

  SingleAnswerQuestion:
    type: object
    allOf:
    - $ref: '#/definitions/Question'
    - type: object
      properties:
        text:
          type: string  
 
        
  Test:
    type: object
    allOf:
    - $ref: '#/definitions/SecuredEntity'
    - type: object
      properties:
        text:
          type: string
        questions:
          type: array
          items:
            $ref: '#/definitions/Question'
        owner:
          $ref: '#/definitions/User'

  TestSet:
    type: object
    allOf:
    - $ref: '#/definitions/Entity'
    - type: object
      properties:
        test:
          $ref: '#/definitions/Test'
        dueDate:
          type: string
          format: date-time
        actorsAssigned:
          type: array
          items:
            $ref: '#/definitions/Actor'
        
  TestExecution:
    type: object
    allOf:
    - $ref: '#/definitions/Entity'
    - type: object
      properties:
        test:
          $ref: '#/definitions/Test'
        answersGiven:
          type: array
          items:
            $ref: '#/definitions/Answer'
        dateOfStart:
          type: string
          format: date-time
        dateOfFill:
          type: string
          format: date-time
            
################################################################################
#                                           Paths                              #
################################################################################
paths:

  /auth/login:
    post:
      tags:
        - Auth
      summary: "Logs user into the system"
      description: ""
      operationId: login
      parameters:
        - in: formData
          name: username
          description: "The user name for login"
          required: false
          type: string
        - in: formData
          name: password
          description: "The password for login in clear text"
          required: false
          type: string
          format: password
      responses:
        "201":
          description: "Successful operation. Return a JWT token"
          schema:
            type: string
        "400":
          description: "Invalid username/password supplied"
          schema:
            $ref: "#/definitions/ErrorMessage" 
        "401":
          description: "Wrong username/password supplied"
          schema:
            $ref: "#/definitions/ErrorMessage"
          
  /auth/logout:
    delete:
      security:
        - Bearer: []
      tags:
        - Auth
      summary: "Invalidate the token of currently logged in user"
      description: ""
      operationId: logout
      produces:
        - application/json        
      responses:
        "204":
          description: "Successful operation"

  /groups:
    get:
      summary: "Get all global group"
      description: ""
      operationId: listGroups
      security:
        - Bearer: []
      tags:
      - Groups
      responses:
        "200":
          description: "The list of group objects"
          schema:
            type: array
            items:
              $ref: '#/definitions/Group'
        "401":
          description: "Access denied"

    post:
      summary: "Add a new group"
      description: ""
      operationId: addGroup
      tags:
      - Groups
      parameters:
        - in: formData
          name: name
          description: "Name of the group"
          required: true
          type: string
        - in: formData
          name: isGlobal
          description: ""
          required: false
          type: boolean
      responses:
        "201":
          description: ""
          schema:
            $ref: '#/definitions/Group'
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
    
  /groups/{groupId}:
    parameters:
      - $ref: '#/parameters/groupId'
    get:
      summary: "Get a group"
      description: ""
      operationId: getGroup
      security:
        - Bearer: []
      tags:
      - Groups
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/Group'
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
            
    put:
      summary: "Update a group"
      operationId: updateGroup
      description: ""
      security:
        - Bearer: []
      tags:
      - Groups
      parameters:
        - in: formData
          name: name
          description: "Name of the group"
          required: true
          type: string
      responses:
        "204":
          description: ""
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
            
    delete:
      summary: "Delete a group"
      operationId: deleteGroup
      description: ""
      security:
        - Bearer: []
      tags:
      - Groups
      responses:
        "204":
          description: ""
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
            
  
  /groups/{groupId}/members:
    parameters:
      - $ref: '#/parameters/groupId'
    get:
      summary: "Get members of the group"
      description: ""
      operationId: listGroupMembers
      security:
        - Bearer: []
      tags:
      - Groups
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/User'
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
            
    post:
      summary: "Add a user as member of the group"
      description: ""
      operationId: addGroupMember
      security:
        - Bearer: []
      tags:
      - Groups
      parameters:
        - in: formData
          name: userId
          description: "Id of the user"
          required: true
          type: string
      responses:
        "201":
          description: ""
          schema:
            $ref: '#/definitions/Group'
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
    
  /groups/{groupId}/members/{userId}:
    parameters:
      - $ref: '#/parameters/groupId'
      - $ref: '#/parameters/userId'
    delete:
      summary: "Remove a user from a group"
      description: ""
      operationId: deleteGroupMemeber
      security:
        - Bearer: []
      tags:
      - Groups
      responses:
        "204":
          description: ""
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"

  /roles:
    get:
      security:
        - Bearer: []
      tags:
      - Roles
      summary:  "Get all roles in the system"
      description: ""
      operationId: listRoles
      responses:
        "200":
          description: "The list of role objects"
          schema:
            type: array
            items:
              $ref: '#/definitions/Role'
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
    post:
      security:
        - Bearer: []
      tags:
      - Roles
      summary: "Add a new role"
      description: ""
      operationId: addRole
      consumes:
        - multipart/form-data
      parameters:
        - name: name
          in: formData
          description: "Name of the role"
          required: true
          type: string
        - name: accessToActors
          in: formData
          required: true
          type: integer
          format: int32
        - name: accessToCategories
          in: formData
          required: true
          type: integer
          format: int32 
        - name: accessTests
          in: formData
          required: true
          type: integer
          format: int32

      responses:
        "201":
          description: "Return no content, but a redirection  header"
          schema:
            type: string
          headers:
            Location:
              description: "The URI of the created role"
              type: string
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"

  /roles/{roleId}:
    parameters:
      - $ref: '#/parameters/roleId'
    get:
      security:
        - Bearer: []
      tags:
      - Roles
      summary:  "Get a role"
      description: ""
      operationId: getRole
      responses:
        "200":
          description: "The list of user objects"
          schema:
            type: array
            items:
              $ref: '#/definitions/User'
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
        "404":
          description: "Object not found"
          schema:
            $ref: "#/definitions/ErrorMessage"
    put:
      security:
        - Bearer: []
      tags:
      - Roles
      summary:  "Update a role"
      description: ""
      operationId: updateRole
      parameters:
        - name: name
          in: formData
          description: "Name of the role"
          required: true
          type: string
        - name: accessToActors
          in: formData
          required: true
          type: integer
          format: int32
        - name: accessToCategories
          in: formData
          required: true
          type: integer
          format: int32 
        - name: accessTests
          in: formData
          required: true
          type: integer
          format: int32
      responses:
        "204":
          description: Successful operation
        "401":
          description: "Access denied"
          schema:
            $ref: "#/definitions/ErrorMessage"
        "404":
          description: "Object not found"
          schema:
            $ref: "#/definitions/ErrorMessage"
            
  /users:
    get:
      security:
        - Bearer: []
      tags:
      - Users
      summary:  "Get all registered users"
      description: "Get all registered users"
      operationId: listUsers
      responses:
        "200":
          description: "The list of user objects"
          schema:
            type: array
            items:
              $ref: '#/definitions/User'
    post:
      security:
        - Bearer: []
      tags:
      - Users
      summary: "Register a new user"
      description: "Register a new user"
      operationId: addUser
      consumes:
        - multipart/form-data
      parameters:
        - name: email
          in: formData
          description: "The users's email"
          required: true
          type: string
        - name: password
          in: formData
          description: "The users's password"
          required: true
          type: string
          format: password
        - name: firstName
          in: formData
          description: "The users's firstname"
          required: false
          type: string
        - name: lastName
          in: formData
          description: "The users's lastname"
          required: false
          type: string 
      responses:
        "201":
          description: "Return no content, but a redirection  header"
          schema:
            type: string
          headers:
            Location:
              description: "The URI of the created user"
              type: string
        "409":
          description: Some unique data (i.e. email address) conflicted with a data of existing user
          schema:
            $ref: "#/definitions/ErrorMessage"
          
  /users/me:
    get:
      security:
        - Bearer: []
      tags:
        - Users
      summary: "Get the actual user"
      description: ""
      operationId: getActualUser
      produces:
        - application/json        
      responses:
        "200":
          description: The user object
          schema:
            $ref: "#/definitions/User" 
    put:
      tags:
      - Users
      summary: "Update user"
      description: This can only be done by the logged in user.
      operationId: updateActualUser
      consumes:
        - multipart/form-data
      parameters:
        - name: email
          in: formData
          description: The users's email
          required: true
          type: string
        - name: password
          in: formData
          description: The users's password
          required: true
          type: string
          format: password
        - name: firstName
          in: formData
          description: The users's firstname
          required: false
          type: string
        - name: lastName
          in: formData
          description: The users's lastname
          required: false
          type: string         
      responses:
        "204":
          description: Successful operation
        "404":
          description: User not found
        "400":
          description: Invalid id supplied
   
  /users/{userId}:
    parameters:
      - $ref: '#/parameters/userId'
    get:
      tags:
        - Users
      summary: "Get basic information about an user"
      description: "Get basic information about an user."
      operationId: getUser
      responses:
        "200":
          description: The user object
          schema:
            $ref: "#/definitions/User"
    put:
      security:
        - Bearer: []
      tags:
        - Users
      summary: "Update a certain user"
      description: "This can only be done by the logged in user."
      operationId: updateUser
      consumes:
        - multipart/form-data
      parameters:
        - name: email
          in: formData
          description: The users's email
          required: true
          type: string
        - name: password
          in: formData
          description: The users's password
          required: true
          type: string
          format: password
        - name: firstName
          in: formData
          description: The users's firstname
          required: false
          type: string
        - name: lastName
          in: formData
          description: The users's lastname
          required: false
          type: string         
      responses:
        "204":
          description: Successful operation
        "404":
          description: User not found
          schema:
            $ref: "#/definitions/ErrorMessage"
        "400":
          description: Invalid id supplied
          schema:
            $ref: "#/definitions/ErrorMessage"
    delete:
      security:
        - Bearer: []
      tags:
        - Users
      summary: "Delete user"
      description: "This can only be done by the logged in user."
      operationId: deleteUser
      produces:
        - application/json        
      responses:
        "204":
          description: Successful operation
        "404":
          description: User not found
          schema:
            $ref: "#/definitions/ErrorMessage"
        "400":
          description: Invalid id supplied
          schema:
            $ref: "#/definitions/ErrorMessage"

#  /users/me/roles:
#    get:
#    
#  /users/{userId}/roles:
#    get:
#    post:
#    
#  /users/{userId}/roles/{roleId}:
#    get:
#    put:
#    delete:
#    
#  /users/me/groups:
#    get:
#    post:
#    
#  /users/me/memberships:
#    get:   
#    
    